{{- define "auth_config" -}}
{{ if .UseApplicationCredentials -}}
auth_type=v3applicationcredential
application_credential_id = {{ .ACID }}
application_credential_secret = {{ .ACSecret }}
{{- else -}}
auth_type=password
username={{ .ServiceUser }}
password = {{ .ServicePassword }}
user_domain_name=Default
project_name=service
project_domain_name=Default
{{- end }}
{{ if (index . "Region") -}}
region_name={{ .Region }}
{{ end -}}
{{- end -}}

[DEFAULT]
# API-specific configuration overrides

[cors]
allowed_origin=*
allow_credentials=true
expose_headers=Content-Type,Cache-Control,Content-Language,Expires,Last-Modified,Pragma
max_age=3600
allow_methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
allow_headers=Content-Type,Cache-Control,Content-Language,Expires,Last-Modified,Pragma,X-Auth-Token

[oslo_middleware]
enable_proxy_headers_parsing=true

{{if .Standalone}}
[ironic]
auth_type=none
{{else}}
[ironic]
auth_url={{ .KeystoneInternalURL }}
{{ template "auth_config" . }}
max_retries=6
retry_interval=10

[keystone_authtoken]
auth_url={{ .KeystoneInternalURL }}
www_authenticate_uri={{ .KeystonePublicURL }}
{{ template "auth_config" . }}

[service_catalog]
auth_url={{ .KeystoneInternalURL }}
{{ template "auth_config" . }}

[glance]
auth_url={{ .KeystoneInternalURL }}
{{ template "auth_config" . }}

[neutron]
auth_url={{ .KeystoneInternalURL }}
{{ template "auth_config" . }}

[nova]
auth_url={{ .KeystoneInternalURL }}
{{ template "auth_config" . }}
{{end}}

{{ if (index . "QuorumQueues") }}
[oslo_messaging_rabbit]
rabbit_quorum_queue=true
rabbit_transient_quorum_queue=true
amqp_durable_queues=true
{{ end }}
